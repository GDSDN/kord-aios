# S04: Implement plan_read Tool

> **Epic**: EPIC-02 Story & Plan Tools
> **Status**: Draft
> **Estimate**: 3h
> **Agent**: @dev
> **Dependencies**: S01 (shared types)

---

## Objective

Implement the `plan_read` tool that parses plan documents generated by @plan. Plans contain epics, stories, tasks, wave assignments, executor designations, and quality gate specifications. @build uses this tool to understand what to execute.

## Tasks

- [ ] Create tool directory: `src/tools/plan-read/`
- [ ] Implement `index.ts` with `createPlanReadTool()` factory
- [ ] Create `types.ts` with tool-specific types (import shared PlanDocument)
- [ ] Create `constants.ts` with tool name, description
- [ ] Create `tools.ts` with tool definition (parameters: plan_path, filter)
- [ ] Parse plan structure: epics, stories/tasks, waves, executors, quality gates, dependencies
- [ ] Support filters: by wave, by status, by executor
- [ ] Handle both story-driven and task-driven plan formats
- [ ] Create `plan-read.test.ts` with test fixtures for both plan formats
- [ ] Run `bun test` — all tests pass

## Acceptance Criteria

- [ ] Tool registered and callable by agents
- [ ] Parses story-driven plans (epics → stories → tasks with executors)
- [ ] Parses task-driven plans (flat task list with executors)
- [ ] Returns typed PlanDocument with wave structure
- [ ] Filter by wave returns only items in that wave
- [ ] Filter by status returns pending/in-progress/done items
- [ ] Tests cover both plan formats + filters

## Files

```
src/tools/plan-read/
  index.ts           ← NEW (createPlanReadTool factory)
  types.ts           ← NEW
  constants.ts       ← NEW
  tools.ts           ← NEW (tool definition)
  plan-read.test.ts  ← NEW
```

## Dev Notes

- Plan format is markdown generated by @plan — define a consistent structure in shared types
- @build iterates: `plan_read(plan_path, {wave: current_wave})` → get items → delegate each
- Reference AIOS: `synkra-aios/.aios-core/development/scripts/story-index-generator.js`
